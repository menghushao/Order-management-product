<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>Excel Grid 106×50</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; }
    th, td {
      border: 1px solid #ccc;
      min-width: 60px;
      height: 24px;
      text-align: center;
    }
    th { background: #eee; position: sticky; top: 0; z-index: 2; }
    th:first-child, td:first-child {
      position: sticky;
      left: 0;
      background: #f3f3f3;
      z-index: 1;
    }
    td:focus { outline: 2px solid #0078D7; }
    button { margin: 10px 0; padding: 8px 16px; }

    td.hover-col, th.hover-col { background-color: #e0f3ff !important; }
    td.hover-row, th.hover-row { background-color: #fff4cc !important; }

    body.locked { display: none; }

    #logoutBtn {
      position: fixed;
      top: 10px;
      right: 10px;
      background: #eee;
      border: 1px solid #ccc;
      padding: 4px 8px;
      cursor: pointer;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
</head>
<body>

<script>
  document.body.classList.add("locked");

  const TAG = "entry-token";
  const now = Date.now();
  const cached = JSON.parse(localStorage.getItem(TAG) || "null");

  if (cached && cached.token && now < cached.expires) {
    document.body.classList.remove("locked");
  } else {
    const token = prompt("🔐 請輸入 GitHub Token 以進入頁面");

    if (!token) {
      alert("❌ 未輸入金鑰，拒絕進入");
      location.href = "about:blank";
    } else {
      fetch("https://api.github.com/user", {
        headers: { Authorization: "Bearer " + token.trim() }
      })
      .then(res => {
        if (!res.ok) throw new Error("Invalid");
        return res.json();
      })
      .then(user => {
        localStorage.setItem(TAG, JSON.stringify({
          token: token.trim(),
          expires: now + 24 * 60 * 60 * 1000
        }));
        document.body.classList.remove("locked");
      })
      .catch(() => {
        alert("❌ 金鑰無效，拒絕進入");
        location.href = "about:blank";
      });
    }
  }
</script>

<h3>表格資料庫（106 × 50）</h3>
<button onclick="save()">💾 儲存（覆蓋 index.html + 加密 gridData.json）</button>
<button id="logoutBtn">🔓 登出金鑰</button>
<table id="grid">
  <thead><tr id="theadRow"><th></th></tr></thead>
  <tbody id="tbody"></tbody>
</table>

<script>
document.getElementById('logoutBtn').addEventListener('click', () => {
  if (confirm("是否要登出金鑰並重新驗證？")) {
    localStorage.removeItem("entry-token");
    location.reload();
  }
});
</script>

<script>
const gridData = [["特價標籤>","雙餡","TEST","C","D","E","F","G","H","I","J","K","L","M","N","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["特價組合數","2","3","","","","","","","","","","","","","<","集","-","點","-","活","-","動","-","支","援","付","款","-",">","","","","","","","","","","","","","","","","","","","",""],["特價金額","35","50","","","","","","","","","","","","","是","否","是","是","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["特價支援支付方式","現金、LINEPAY、全支付","現金、LINEPAY、全支付","","","","","","","","","","","","","<","集","點","卡","、","滿","額","折","扣","支","援","付","款","-",">","","","","","","","","","","","","","","","","","","","",""],["特價參加折扣","是","否","","","","","","","","","","","","","是","否","是","是","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["特價參加發點","是","否","","","","","","","","","","","","","<","-","支","-","-","付","-","-","方","-","-","式","-","-",">","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","現金","Ｕber Eats","LINEPAY","全支付","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","<","-","支","-","-","付","-","-","抽","-","-","成","-","-",">","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","1","0.69","0.97","0.978","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["品項","產品","簡稱","特價標","成本","附屬1","附屬2","附屬3","附屬4","附屬5","附屬6","附屬7","附屬8","附屬9","附屬10","<","-","通","-","-","路","-","-","售","-","-","價","-","-",">","常價幾個一份","常價參加折扣","常價參加集點","品項排序","","","","","","","","","","","","","","","",""],["雞蛋糕","純雞蛋糕","純","","3.22","焦","","","","","","","","","","10","11.5","10","10","","","","","","","","","","","","2","是","是","雞蛋糕","","","","","","","","","","","","","","","",""],["餅乾","餅乾(3顆)","餅","","4.88","焦","","","","","","","","","","15","","15","15","","","","","","","","","","","","1","是","是","餅乾","","","","","","","","","","","","","","","",""],["雞蛋糕","巧克力","巧","","4.72","焦","","","","","","","","","","15","16.5","15","15","","","","","","","","","","","","2","是","是","飲品","","","","","","","","","","","","","","","",""],["雞蛋糕","奶油","奶","","3.26","焦","","","","","","","","","","15","16.5","15","15","","","","","","","","","","","","2","是","是","咖啡","","","","","","","","","","","","","","","",""],["雞蛋糕","鹹蛋黃","鹹","","7.06","焦","","","","","","","","","","15","16.5","15","15","","","","","","","","","","","","2","是","是","包裝","","","","","","","","","","","","","","","",""],["雞蛋糕","抹茶","抹","TEST","4.95","焦","","","","","","","","","","15","16.5","15","15","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","紅豆","紅","","4.74","焦","","","","","","","","","","15","16.5","15","15","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","芝麻","芝","","3.68","焦","","","","","","","","","","15","16.5","15","15","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","蒜香","蒜","","3.93","焦","","","","","","","","","","15","16.5","15","15","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","梅子花生","花","TEST","4.71","焦","","","","","","","","","","15","16.5","15","15","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","草莓","梅","","3.61","焦","","","","","","","","","","15","16.5","15","15","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","雙色乳酪","酪","雙餡","9.98","焦","","","","","","","","","","20","19","20","20","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","奶油鹹蛋","奶鹹","雙餡","5.69","焦","","","","","","","","","","20","19","20","20","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","巧克力花生","巧花","雙餡","5.25","焦","","","","","","","","","","20","19","20","20","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","巧克力芝麻","巧芝","雙餡","4.45","焦","","","","","","","","","","20","19","20","20","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","抹茶巧克力","抹巧","雙餡","5.31","焦","","","","","","","","","","20","19","20","20","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","抹茶紅豆","抹紅","雙餡","5.3","焦","","","","","","","","","","20","19","20","20","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","玉米濃湯","濃","雙餡","3.61","焦","","","","","","","","","","20","19","20","20","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["飲品","冬瓜茶外帶","冬外","TEST","9.57","去冰","","","","","","","","","","25","30","25","25","","","","","","","","","","","","1","是","是","","","","","","","","","","","","","","","","",""],["飲品","冬瓜茶內用","冬內","","1.68","去冰","","","","","","","","","","10","","10","10","","","","","","","","","","","","1","是","是","","","","","","","","","","","","","","","","",""],["飲品","冬瓜鮮奶外帶","冬鮮外","","28.39","去冰","","","","","","","","","","45","","45","45","","","","","","","","","","","","1","是","是","","","","","","","","","","","","","","","","",""],["飲品","冬瓜鮮奶內用","冬鮮內","","11.85","去冰","","","","","","","","","","25","","20","20","","","","","","","","","","","","1","是","是","","","","","","","","","","","","","","","","",""],["飲品","燒仙草外帶","仙外","","13.56","","","","","","","","","","","40","45","40","40","","","","","","","","","","","","1","是","是","","","","","","","","","","","","","","","","",""],["飲品","燒仙草內用","仙內","","2.2","","","","","","","","","","","20","","20","20","","","","","","","","","","","","1","是","是","","","","","","","","","","","","","","","","",""],["咖啡","拿鐵外帶","拿外","","65.02","經典","低經","花果","香草","焦糖","胡椒","冰","去冰","","","95","125","95","95","","","","","","","","","","","","1","是","是","","","","","","","","","","","","","","","","",""],["咖啡","拿鐵內用","拿內","","29","經典","低經","花果","香草","焦糖","胡椒","冰","去冰","","","55","85","55","55","","","","","","","","","","","","1","是","是","","","","","","","","","","","","","","","","",""],["咖啡","美式外帶","美外","","44.65","經典","低經","花果","香草","焦糖","胡椒","冰","去冰","","","60","","60","60","","","","","","","","","","","","1","是","是","","","","","","","","","","","","","","","","",""],["咖啡","美式內用","美內","","19","經典","低經","花果","香草","焦糖","胡椒","冰","去冰","","","35","","35","35","","","","","","","","","","","","1","是","是","","","","","","","","","","","","","","","","",""],["包裝","不織布提網","提網","","1.22","","","","","","","","","","","5","6","5","5","","","","","","","","","","","","1","否","否","","","","","","","","","","","","","","","","",""],["雞蛋糕","混巧","混巧","雙餡","5.5","奶","鹹","抹","紅","芝","蒜","花","莓","焦","","20","","20","20","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","混奶","混奶","雙餡","5.5","巧","鹹","抹","紅","芝","蒜","花","莓","焦","","20","","20","20","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","混鹹","混鹹","雙餡","5.5","巧","奶","抹","紅","芝","蒜","花","莓","焦","","20","","20","20","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","混抹","混抹","雙餡","5.5","巧","奶","鹹","紅","芝","蒜","花","莓","焦","","20","","20","20","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","混紅","混紅","雙餡","5.5","巧","奶","鹹","抹","芝","蒜","花","莓","焦","","20","","20","20","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","混芝","混芝","雙餡","5.5","巧","奶","鹹","抹","紅","蒜","花","莓","焦","","20","","20","20","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","混蒜","混蒜","雙餡","5.5","巧","奶","鹹","抹","紅","芝","花","莓","焦","","20","","20","20","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","混花","混花","雙餡","5.5","巧","奶","鹹","抹","紅","芝","花","莓","焦","","20","","20","20","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["雞蛋糕","混莓","混莓","雙餡","5.5","巧","奶","鹹","抹","紅","芝","蒜","花","焦","","20","","20","20","","","","","","","","","","","","2","是","是","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]];
// @@gridData@@
</script>

<script>
const ROWS = 106, COLS = 50;
const user = 'menghushao';
const repo = 'Order-management-product';
const path = 'index.html';
const jsonPath = 'gridData.json';
const branch = 'main';

const theadRow = document.getElementById('theadRow');
const tbody = document.getElementById('tbody');

for (let c = 0; c < COLS; c++) {
  let label = '', n = c;
  while (n >= 0) {
    label = String.fromCharCode(n % 26 + 65) + label;
    n = Math.floor(n / 26) - 1;
  }
  const th = document.createElement('th');
  th.textContent = label;
  theadRow.appendChild(th);
}

for (let r = 0; r < ROWS; r++) {
  const tr = document.createElement('tr');
  const rowTh = document.createElement('th');
  rowTh.textContent = r + 1;
  tr.appendChild(rowTh);
  for (let c = 0; c < COLS; c++) {
    const td = document.createElement('td');
    td.contentEditable = true;
    tr.appendChild(td);
  }
  tbody.appendChild(tr);
}

for (let r = 0; r < ROWS; r++) {
  for (let c = 0; c < COLS; c++) {
    const val = (gridData[r] && gridData[r][c]) || "";
    tbody.rows[r].cells[c + 1].textContent = val;
  }
}

tbody.addEventListener('mouseover', e => {
  if (e.target.tagName !== 'TD') return;
  const td = e.target;
  clearHighlight();

  const tr = td.parentElement;
  const rowIndex = tr.rowIndex - 1;
  const colIndex = td.cellIndex;

  for (let r = 0; r < ROWS; r++) {
    const cell = tbody.rows[r].cells[colIndex];
    if (cell) cell.classList.add('hover-col');
  }

  [...tr.children].forEach(cell => cell.classList.add('hover-row'));
  theadRow.cells[colIndex].classList.add('hover-col');
  tbody.rows[rowIndex].cells[0].classList.add('hover-row');
});

tbody.addEventListener('mouseout', clearHighlight);
function clearHighlight() {
  document.querySelectorAll('.hover-col, .hover-row').forEach(el =>
    el.classList.remove('hover-col', 'hover-row')
  );
}

window.addEventListener("beforeunload", function (e) {
  e.preventDefault();
  e.returnValue = '';
});

async function save() {
  const token = prompt("請再次輸入 GitHub Token 作為加密密鑰");
  if (!token) return;

  const values = Array.from({ length: ROWS }, (_, r) =>
    Array.from({ length: COLS }, (_, c) =>
      (tbody.rows[r]?.cells[c + 1]?.textContent || "").trim()
    )
  );
    // 更新 index.html：把 gridData 塞回碼中
  const updatedCode = `const gridData = ${JSON.stringify(values)};\n// @@gridData@@`;
  const sourceURL = `https://raw.githubusercontent.com/${user}/${repo}/${branch}/${path}`;
  const original = await fetch(sourceURL).then(r => r.text());
  const replaced = original.replace(/const gridData = .*?\/\/ @@gridData@@/s, updatedCode);
  const base64 = btoa(unescape(encodeURIComponent(replaced)));

  const metaURL = `https://api.github.com/repos/${user}/${repo}/contents/${path}?ref=${branch}`;
  const { sha } = await fetch(metaURL, {
    headers: { Authorization: `Bearer ${token}` }
  }).then(r => r.json());

  const upload = await fetch(metaURL.replace('?ref=' + branch, ''), {
    method: 'PUT',
    headers: {
      Authorization: `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      message: '🔐 加密儲存 gridData.json + 更新 index.html',
      content: base64,
      sha,
      branch
    })
  });

  if (!upload.ok) {
    const err = await upload.text();
    alert('❌ index.html 儲存失敗：' + err);
    return;
  }

  // 加密 gridData → 儲存 gridData.json
  const key = CryptoJS.enc.Utf8.parse(token.trim().slice(0, 32).padEnd(32, '0'));
  const iv = CryptoJS.lib.WordArray.random(16);
  const encrypted = CryptoJS.AES.encrypt(
    JSON.stringify(values),
    key,
    { iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 }
  );
  const cipherText = encrypted.ciphertext.toString(CryptoJS.enc.Base64);
  const ivHex = iv.toString(CryptoJS.enc.Hex);

  const encData = {
    ciphertext: cipherText,
    iv: ivHex
  };
  const jsonRaw = JSON.stringify(encData, null, 2);
  const jsonBase64 = btoa(unescape(encodeURIComponent(jsonRaw)));

  const jsonURL = `https://api.github.com/repos/${user}/${repo}/contents/${jsonPath}?ref=${branch}`;
  const meta = await fetch(jsonURL, {
    headers: { Authorization: `Bearer ${token}` }
  }).then(r => r.ok ? r.json() : { sha: null });

  const uploadJSON = await fetch(jsonURL.replace('?ref=' + branch, ''), {
    method: 'PUT',
    headers: {
      Authorization: `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      message: '🔐 加密儲存 gridData.json',
      content: jsonBase64,
      sha: meta.sha || undefined,
      branch
    })
  });

  if (uploadJSON.ok) {
    alert("✅ 已儲存 index.html 並加密寫入 gridData.json");
  } else {
    const err = await uploadJSON.text();
    alert("⚠️ index.html 更新成功，但 gridData.json 儲存失敗：" + err);
  }
}
</script>

</body>
</html>
