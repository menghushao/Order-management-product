<!DOCTYPE html>
<html lang="zh-Hant"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>萌虎燒 | 雞蛋糕・甜點・下午茶</title>
  <meta name="description" content="萌虎燒是苗栗市的現點現做雞蛋糕專賣店，提供多種創意口味與飲品，支援外送與線上點餐。">
  <meta name="keywords" content="萌虎燒,雞蛋糕,苗栗雞蛋糕,甜點,下午茶,苗栗點心,萌虎燒菜單,萌虎燒訂購">

<style>
/* === Cart Overlay v1.7.0 (mobile polished) === */
:root{
  --mh-muted:#4b5563; --mh-text:#111827; --mh-line:#e5e7eb; --mh-card:#ffffff;
  --mh-accent:#3b82f6;
  --mh-cart-bg:#f5ede3;        /* 淡咖啡底 */
  --mh-cart-text:#2b1d14;      /* 深咖啡字 */
}
.mh-fab, .mh-panel, .mh-cart, .mh-toast { font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", Arial; }
.mh-fab{
  position: fixed; z-index: 10001; top: 14px;
  left: 50%; transform: translateX(0);
  background: linear-gradient(180deg, #60a5fa, #3b82f6);
  color:#fff; border:0; border-radius:999px; padding:10px 14px; font-size:14px; cursor:pointer;
  box-shadow:0 6px 24px rgba(59,130,246,.35);
}
#mh-cart-fab{
  position: fixed; z-index: 10001; top: 14px; left: calc(50% + 100px);
  background: linear-gradient(180deg, #a7805a, #8b6a49); color:#fff; border:0; border-radius:999px; padding:10px 14px; font-size:14px;
  box-shadow:0 6px 24px rgba(0,0,0,.25);
}
.mh-cart{
  position: fixed; z-index: 10000;
  top: 64px; left: 50%; width: 360px; background: var(--mh-cart-bg);
  border:1px solid #e1d5c7; border-radius:16px; padding:12px;
  display:grid; gap:10px; max-height:72vh; overflow:auto; color: var(--mh-cart-text);
  box-shadow: 0 10px 24px rgba(0,0,0,.12);
}
.mh-cart h4{ margin:0; font-size:15px; display:flex; align-items:center; justify-content:space-between; gap:6px; color: var(--mh-cart-text); }
.mh-badge{ font-size:12px; padding:2px 8px; border-radius:999px; background:#efe4d7; color:#5b402d; border:1px solid #e1d5c7; }
.mh-cart-empty{ color:#6b4f3f; font-size:13px; }
.mh-cart-list{ display:grid; gap:10px; }
.mh-cart-item{ border:1px solid #e1d5c7; border-radius:12px; padding:10px; background:#fffdf9; display:flex; align-items:center; justify-content:space-between; gap:8px; }
.mh-name{ font-size:14px; color:#2b1d14; }
.mh-del, .mh-edit{ background:#fff; border:1px solid #d9cbbb; color:#533b2a; border-radius:10px; padding:6px 8px; cursor:pointer; }
.mh-btn{ padding:10px 14px; border-radius:10px; border:1px solid #cbd5e1; background:#f8fafc; color:#111827; cursor:pointer; }
.mh-btn.primary{ background: linear-gradient(180deg, #60a5fa, #3b82f6); border:none; color:#fff; }
.mh-field label{ font-size:12px; color:#6b7280; display:block; margin:0 0 4px; }
.mh-input, .mh-select, .mh-number {
  width:100%; padding:8px 10px; border-radius:10px; border:1px solid #cbd5e1; background:#fff; color:#111827; font-size:14px;
}
.mh-row-2{ display:grid; grid-template-columns:1fr 1fr; gap:8px; }
.mh-row-3{ display:grid; grid-template-columns:repeat(3,1fr); gap:8px; }
.mh-total{ padding:10px; border:1px dashed #d1d5db; border-radius:10px; font-size:14px; color:#111827; background:#f9fafb; }
.mh-total small{ color:#6b7280; }

/* Slide-over order panel */
.mh-panel{
  position: fixed; right: -420px; top: 0; height: 100vh; width: 400px;
  background: #ffffff;
  border-left:1px solid #e5e7eb;
  box-shadow:-10px 0 40px rgba(0,0,0,.08);
  transition:right .22s ease;
  display:grid; grid-template-rows:auto 1fr auto;
  overflow:hidden;
  color:#111827; z-index: 10002;
}
.mh-panel.open{ right:0; }
.mh-panel-head{ padding:12px 14px; border-bottom:1px solid #e5e7eb; display:flex; align-items:center; justify-content:space-between; gap:8px; background:#f8fafc; }
.mh-panel-body{ padding:12px 14px; overflow:auto; }
.mh-panel-actions{ display:flex; gap:8px; padding:12px 14px; border-top:1px solid #e5e7eb; background:#f8fafc; }

/* Mobile layout improvements */
@media (max-width:1023.98px){
  .mh-fab{ left: 12px; transform:none; top:auto; bottom: 12px; }
  #mh-cart-fab{ left:auto; right:12px; top:auto; bottom: 64px; }
  .mh-panel{
    left:0; right:0; width:100vw; bottom:0; top:auto; height:auto; max-height:86vh;
    border-left:none; border-top:1px solid #e5e7eb; border-radius:12px 12px 0 0;
    transform: translateY(110%); transition: transform .22s ease;
    box-shadow: 0 -10px 24px rgba(0,0,0,.12);
  }
  .mh-panel.open{ transform: translateY(0); }
  .mh-panel-body{ max-height: calc(86vh - 76px); overflow:auto; -webkit-overflow-scrolling: touch; }
  .mh-panel-actions{ display:none; } /* hide bottom bar on mobile */
  .mh-actions-inline{
    position: sticky; bottom: 0; z-index: 2;
    display:flex; gap:8px; padding:10px 12px; background:#ffffff; border-top:1px solid #e5e7eb;
  }
  .mh-actions-inline .mh-btn{ flex:1; min-height:44px; }
  .mh-cart{ left:0; right:0; top:auto; bottom:0; width:auto; max-height:60vh; border-radius:12px 12px 0 0; }
}
@media (min-width:1024px){
  #mh-cart-fab{ display:none; }
}
</style>


<style>
/* === v1.7.1: Cart collapsed by default, toggle to open === */
.mh-cart{
  opacity: 0; visibility: hidden; pointer-events: none;
  transform: translateY(0);
  transition: opacity .2s ease, transform .22s ease, visibility 0s linear .22s;
}
.mh-cart.open{
  opacity: 1; visibility: visible; pointer-events: auto;
  transition: opacity .2s ease, transform .22s ease, visibility 0s;
}
@media (max-width:1023.98px){
  /* Mobile slide-up */
  .mh-cart{
    bottom:0; left:0; right:0;
    transform: translateY(100%);
  }
  .mh-cart.open{
    transform: translateY(0);
  }
}
</style>


<style>
/* === v1.7.2: cart toggle & desktop FAB + hide inline actions on desktop === */
#mh-cart-fab{
  z-index: 10003; /* above the cart drawer so it's clickable */
}
/* Add a small collapse button in cart header */
#mh-cart .mh-close{
  background:#fff; border:1px solid #d9cbbb; color:#533b2a; border-radius:10px; padding:6px 8px; cursor:pointer; font-size:12px;
}
/* Desktop should show inline actions? No, hide to avoid duplicates */
@media (min-width:1024px){
  .mh-actions-inline{ display:none !important; }
  /* Show the cart FAB on desktop too and position via JS */
  #mh-cart-fab{ display:inline-block; }
}
</style>


<style>
/* === v1.7.3: button layout & icon swap === */
/* Mobile: both buttons on the right, stacked (點餐在上、購物車在下) */
@media (max-width:1023.98px){
  .mh-fab{ left:auto !important; right:12px !important; bottom:64px !important; top:auto !important; transform:none !important; }
  #mh-cart-fab{ left:auto !important; right:12px !important; bottom:12px !important; top:auto !important; }
  .mh-panel-actions{ display:none !important; }   /* keep inline actions only on mobile */
}
/* Desktop: hide inline actions to avoid duplication; show bottom bar */
@media (min-width:1024px){
  .mh-actions-inline{ display:none !important; }
  .mh-panel-actions{ display:flex !important; }
}
</style>

</head>
<body>

<section style="position: relative; display: flex; flex-wrap: wrap; justify-content: center; gap: 2em; padding: 2em 1em; font-size: 1.05rem; line-height: 1.6; background: #fffefb; max-width: 1280px; margin: auto;">
  <!-- 左頁：店家資訊 -->
  <div style="flex: 1 1 320px; background: #fffbe7; padding: 1.5em; border-radius: 8px 0 0 8px; box-shadow: -4px 4px 12px rgba(0,0,0,0.08); z-index: 2;">
    <h2 style="color: #e65100;">
     萌虎燒   <img src="https://github.com/menghushao/MENU/blob/main/%E5%8E%9F%E5%A7%8B%E8%99%8E%E9%A0%AD(%E5%8E%BB%E8%83%8C).png?raw=true" alt="logo" style="width: 1.2em; height: 1.2em; vertical-align: middle; margin-right: 0.3em; border-radius: 3px;">
      店家資訊
    </h2>
    <p><strong>地址：</strong><a href="https://maps.app.goo.gl/B6KTsppsNF3jqvfC9" target="_blank">苗栗市中山路203號</a><br><em>單向雙線道，汽車停車位設置在右側，我們在左側，機/腳踏車可以停在騎樓(暫時)。</em></p>
    <p><strong>電話：</strong>
      <a href="tel:0912457104" style="color: inherit; text-decoration: underline;">0912457104<em>  (拒接隱藏來電號碼)</em></a>
    </p>
    <p><strong>官方LINE：</strong>
      <a href="https://reurl.cc/qZAE2y" target="_blank" style="margin-left: 0.5em;">
        <img src="https://pic.pimg.tw/softwarecenter/1405438113-157016513.png" alt="LINE" style="width: 1.6em; vertical-align: middle;">
      </a><em>   (回覆速度較快)</em>
    </p>
    <p><strong>官 方 F B ：  </strong>
      <a href="https://m.me/menghushao" target="_blank" style="margin-left: 0.5em;">
        <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" alt="FB" style="width: 1.4em; vertical-align: middle;">
      </a>
    </p>
    <p><strong>營業時間：</strong><br><em>週日固定休息<br>週一 ~ 五 的11:00 ~ 22:00<br>週六 的10:00 ~ 23:59</em></p>
    <p><strong>臨時休息日：<br></strong><em>2025/07/30(三)11:00 ~ 18:00<br>2025/08/02(六)10:00 ~ 17:00</em>
    </p><p><strong>Wi-Fi 密碼：</strong>0912457104</p>
    <p>📄 有統編章可供公司行號核銷點心費用，可使用現金、LINEPAY、全支付結帳。</p>
    <p>⏱️ 餐點都是現點現做，可透過電話或通訊軟體提前預訂，避免現場等待。<br>🕓 若有營業時間外的訂單需求，可以提前跟老闆聯繫商量。</p>
    <p>
  🛵 滿300元苗栗市門牌可外送，不滿可透過
  <a href="https://www.ubereats.com/tw/store/%E8%90%8C%E8%99%8E%E7%87%92-%E7%94%9C%E9%BB%9E-%E4%B8%8B%E5%8D%88%E8%8C%B6-%E9%BB%9E%E5%BF%83-%E9%9B%9E%E8%9B%8B%E7%B3%95/C-zADMIpWq-_9Pep-1uOVQ?diningMode=DELIVERY&amp;sc=SEARCH_SUGGESTION" target="_blank">UBER Eats</a>
  點餐，市外建議透過
  <a href="https://maps.app.goo.gl/B6KTsppsNF3jqvfC9" target="_blank">GOOGLE地圖</a>
  避開收費路段，取得與萌虎燒的距離 (公里)，再填入下方欄位估算保送門檻。
  <input type="number" id="distanceInput" min="0" step="0.1" style="width: 5em; margin-left: 0.3em;">
  <span id="deliveryMsg" style="margin-left: 0.5em; color: #d32f2f;"></span>
</p>
    <script>
      const distanceInput = document.getElementById("distanceInput");
      const deliveryMsg = document.getElementById("deliveryMsg");
      distanceInput?.addEventListener("input", () => {
        const km = parseFloat(distanceInput.value) || 0;
        const fullKM = Math.ceil(km);
        let amount = 0;
        if (fullKM <= 3) amount = 300;
        else if (fullKM <= 15) amount = 300 + (fullKM - 3) * 100;
        else amount = 300 + (fullKM - 3) * 150;
        deliveryMsg.textContent = `需滿 ${amount} 元，請先聯繫店家評估`;
      });
    </script>
    <p>🚫 我們「不」提供塑膠袋和吸管，雞蛋糕單次消費滿5份，會提供一個不織布提網，滿12份再加贈萌虎不織布提袋，外送量大會使用二手但乾淨的紙箱。</p>
<p>🎟️單次消費滿60元可獲得集點卡1點，餐點滿6份點數雙倍，滿12份直接折抵1份，點數改贈1點。集滿10點可兌換任何口味雞蛋糕1份。</p>
    <p>⚠️ 偶有麵糊沒完全熟透的情況，這無法完全避免，若發生了請告訴我們，我們將直接退回餐點費用。</p>
    <p>🛍️ <a href="https://reurl.cc/Aym5rE" target="_blank">[萌虎燒-石虎小貓貓] LINE 貼圖</a></p>
  </div>
  <!-- 右頁：菜單與點餐 -->
  <div id="menu-root" data-menu="" style="flex: 1 1 640px; background: #fff; padding: 1.5em; border-radius: 0 8px 8px 0; box-shadow: 4px 4px 12px rgba(0,0,0,0.08); z-index: 2;">
    <h2 style="color: #e65100;">🐣 雞蛋糕</h2>
     <li><em>霜淇淋由於客流量不高，所以多數都是倒掉，為避免浪費故暫時不會販售。若對機器有興趣，可以跟老闆聯繫商談。</em></li>
    <p><strong>一份皆為 2 顆</strong>，可混搭不同口味與價位。<br>自備容器集點卡加贈1點~</p>
    <ul>
      <li><strong>純雞蛋糕</strong>：<br>2 顆 20元，混區組合價10元<br><em>只有蛋糕體</em></li>
      <li><strong>單餡雞蛋糕</strong>：<br>2 顆 30元，混區組合價 15元<br><em>檬香、巧克力、奶油、鹹蛋黃、抹茶、紅豆、芝麻、蒜香、梅子花生、草莓</em></li>
      <li><strong>雙餡雞蛋糕</strong>：<br>2 顆 35元，混區組合價20元<br><em>奶油鹹蛋、雙色乳酪、抹茶紅豆、抹茶巧克力、芝麻巧克力、花生巧克力、玉米濃湯</em></li>
    </ul>

    <hr style="margin: 2em 0;">

    <h2 style="color: #00796b;">🧋 飲品</h2>
    <p><strong>外帶自備悲劇折 10 元</strong>！甜度無法調整，冰塊可調整。</p>
    <ul>
      <li><strong>冬瓜茶</strong>：<br>外帶 480mL 25元 ／ 內用 240mL 10元</li>
      <li><strong>冬瓜茶檸檬</strong>：<br>外帶 480mL 30元 ／ 內用 240mL 15元</li>
      <li><strong>冬瓜鮮奶</strong>：<br>外帶 480mL 45元 ／ 內用 240mL 25元</li>
      <li><strong>燒仙草（熱）</strong>：<br>外帶 480mL 40元（目前停供）／ 內用 240mL 20元</li>
    </ul>

    <hr style="margin: 2em 0;">

    <h2 style="color: #6d4c41;">☕ 咖啡</h2>
    <p><strong>外帶自備悲劇折 10 元</strong>！風味為香氣呈現，全無糖、不提供糖，冰／熱可調。</p>

    <p><strong>先選風味：</strong></p>
    <ul>
      <li>經典（烘焙 33%，咖啡因 75mg）</li>
      <li>低因經典（烘焙 33%，咖啡因 2mg）</li>
      <li>香草（烘焙 58%，咖啡因 68mg）</li>
      <li>焦糖（烘焙 58%，咖啡因 68mg）</li>
      <li>花果（烘焙 16%，咖啡因 69mg）</li>
      <li>胡椒（烘焙 75%，咖啡因 55mg）</li>
    </ul>

    <p><strong>再選作法：</strong></p>
    <ul>
      <li><strong>美式</strong>：<br>內用 240mL 35元 ／ 外帶 480mL 60元</li>
      <li><strong>拿鐵</strong>：<br>內用 240mL 55元 ／ 外帶 480mL 95元</li>
      <li><strong>萌翻拿鐵</strong>：<br>240mL  65元 （限定內用）
        <br><em>奶泡灑上一隻萌虎巧克力粉圖案。灑成功是萌翻拿鐵，失敗就是憨翻拿鐵，老闆不會重做一杯但會少收10元，所以親愛的萌友們要承擔一點看到憨臉的風險</em> 🐯💥
      </li>
    </ul>

    </div>
</section>

<!-- ✅ 瀏覽人次區塊：使用 vercount.one，穩定顯示人次 -->
<div style="text-align: center; margin: 2em 0; font-size: 14px;">
  🐾 來訪萌友第 <span id="busuanzi_value_site_pv">載入中...</span> 位！
</div>

<script async="" src="https://vercount.one/js"></script>

  





<!-- === 點餐 / 購物車 v1.7.0 === -->
<button id="mh-fab" class="mh-fab" title="打開點餐面板">🧾 點餐</button>
<button id="mh-cart-fab" title="開啟購物車">🛒 購物車</button>

<aside id="mh-cart" class="mh-cart" aria-label="購物車">
  <h4>購物車 <small id="mh-cart-count" class="mh-badge">0</small><button id="mh-cart-close" class="mh-close">收合</button></h4>
  <div id="mh-cart-list" class="mh-cart-list"></div>
  <div id="mh-cart-empty" class="mh-cart-empty">尚無品項</div>

  <div class="mh-total" id="mh-summary">
    <div id="mh-summary-line">訂單金額 — 元；滿份折 0 份 0 元；結帳金額 — 元；點數發放 — 點</div>
  </div>

  <div class="mh-field"><label for="mh-when">取餐/送達時間（可留空）</label><input id="mh-when" type="datetime-local" class="mh-input"></div>
  <div class="mh-field"><label for="mh-addr">外送地址（留空＝到店取餐）</label><input id="mh-addr" type="text" class="mh-input" placeholder="台北市信義區..."></div>
  <div class="mh-row-2">
    <div class="mh-field"><label for="mh-sign">招牌</label><input id="mh-sign" type="text" class="mh-input" placeholder="例如：OO便利商店"></div>
    <div class="mh-field"><label for="mh-name">稱呼</label><input id="mh-name" type="text" class="mh-input" placeholder="王先生 / 小美"></div>
  </div>
  <div class="mh-field"><label for="mh-phone">電話</label><input id="mh-phone" type="tel" class="mh-input" placeholder="0912-345678"></div>

  <div class="mh-field">
    <label for="mh-channel">發送媒介</label>
    <select id="mh-channel" class="mh-select">
      <option value="LINE|https://reurl.cc/qZAE2y">LINE</option>
      <option value="FB|https://m.me/menghushao">FB</option>
    </select>
  </div>

  <div class="mh-panel-actions">
    <button id="mh-copy" class="mh-btn">複製訂單</button>
    <button id="mh-send" class="mh-btn primary">送出訂單</button>
    <button id="mh-clear" class="mh-btn">清空購物車</button>
  </div>
</aside>

<section id="mh-panel" class="mh-panel" aria-hidden="true">
  <div class="mh-panel-head">
    <strong>建立訂單小卡</strong>
    <button id="mh-close" class="mh-btn">關閉</button>
  </div>
  <div class="mh-panel-body">
    <div class="mh-field">
      <label for="mh-type">品項</label>
      <select id="mh-type" class="mh-select"><option value="">請選擇</option></select>
    </div>
    <div class="mh-row-2">
      <div class="mh-field">
        <label for="mh-qty">數量</label>
        <input id="mh-qty" class="mh-number" type="number" min="1" step="1" value="1" />
      </div>
      <div class="mh-field"><label>&nbsp;</label><div style="height:1px"></div></div>
    </div>
    <div class="mh-row-2">
      <div class="mh-field">
        <label for="mh-a">商品</label>
        <select id="mh-a" class="mh-select"><option value="">商品</option></select>
      </div>
      <div class="mh-field" id="mh-b-wrap">
        <label for="mh-b">商品</label>
        <select id="mh-b" class="mh-select"><option value="">商品</option></select>
      </div>
    </div>
    <div class="mh-field">
      <label class="mh-label">附項（最多 6）</label>
      <div class="mh-row-3">
        <select class="mh-select mh-acc"><option value="">附</option></select>
        <select class="mh-select mh-acc"><option value="">附</option></select>
        <select class="mh-select mh-acc"><option value="">附</option></select>
        <select class="mh-select mh-acc"><option value="">附</option></select>
        <select class="mh-select mh-acc"><option value="">附</option></select>
        <select class="mh-select mh-acc"><option value="">附</option></select>
      </div>
    </div>
    <!-- 行動版：把操作鈕放在附項下方 -->
    <div class="mh-actions-inline">
      <button id="mh-add-inline" class="mh-btn primary">加入購物車</button>
      <button id="mh-reset-inline" class="mh-btn">清空</button>
    </div>
  </div>
  <!-- 桌面版底部操作區 -->
  <div class="mh-panel-actions">
    <button id="mh-add" class="mh-btn primary">加入購物車</button>
    <button id="mh-reset" class="mh-btn">清空</button>
  </div>
</section>


<script>
(function(){
  const DATA_URL = "https://raw.githubusercontent.com/menghushao/Order-management-product/main/gridData.plain.json";
  const PAY = "現金";
  const MONEY_PER_POINT = 60; // 門檻
  const MAX_LEFTOVER_POINTS = 9;
  const CYCLE_SET = 12; // 每 12 份 1 點

  // State
  let grid=[], rows=[], typeToItems=new Map(), itemToAccs=new Map();
  let cart=[];

  // DOM
  const menuRoot = document.querySelector('#menu-root, main .markdown-body, main, article, .content, .post, .wrap, .container');
  const fab = document.getElementById('mh-fab');
  const cartFab = document.getElementById('mh-cart-fab');
  const panel = document.getElementById('mh-panel');
  const closeBtn = document.getElementById('mh-close');
  const typeSel = document.getElementById('mh-type');
  const aSel = document.getElementById('mh-a');
  const bSel = document.getElementById('mh-b');
  const bWrap = document.getElementById('mh-b-wrap');
  const accSelects = Array.from(document.querySelectorAll('.mh-acc'));
  const qtyInput = document.getElementById('mh-qty');
  const addBtn = document.getElementById('mh-add');
  const resetBtn = document.getElementById('mh-reset');
  const addInline = document.getElementById('mh-add-inline');
  const resetInline = document.getElementById('mh-reset-inline');

  const cartEl = document.getElementById('mh-cart');
  const cartList = document.getElementById('mh-cart-list');
  const cartEmpty = document.getElementById('mh-cart-empty');
  const cartCount = document.getElementById('mh-cart-count');
  const clearBtn = document.getElementById('mh-clear');
  const summaryLine = document.getElementById('mh-summary-line');

  const whenInput = document.getElementById('mh-when');
  const addrInput = document.getElementById('mh-addr');
  const signInput = document.getElementById('mh-sign');
  const nameInput = document.getElementById('mh-name');
  const phoneInput = document.getElementById('mh-phone');
  const channelSel = document.getElementById('mh-channel');
  const copyBtn = document.getElementById('mh-copy');
  const sendBtn = document.getElementById('mh-send');

  // Positioning to menu edge on desktop
  function placeAtMenuEdge(el, extraTop){
    const rect = menuRoot?.getBoundingClientRect?.();
    if (rect && window.matchMedia('(min-width:1024px)').matches){
      el.style.left = (rect.right + 12) + 'px';
      if (typeof extraTop === 'number') el.style.top = extraTop + 'px';
    } else {
      el.style.left = '';
    }
  }
  function placeAll(){ if (window.matchMedia('(min-width:1024px)').matches){ placeAtMenuEdge(fab,14); placeAtMenuEdge(cartEl,64); } }
  window.addEventListener('resize', placeAll); window.addEventListener('scroll', placeAll);

  // Open/close panel + cart
  function openPanel(){ panel.classList.add('open'); panel.setAttribute('aria-hidden','false'); }
  function closePanel(){ panel.classList.remove('open'); panel.setAttribute('aria-hidden','true'); }
  fab.addEventListener('click', openPanel); closeBtn.addEventListener('click', closePanel);
  cartFab.addEventListener('click', ()=>{ cartEl.classList.toggle('open'); });

  // Helpers
  function opt(label,value){ const o=document.createElement('option'); o.textContent=label; o.value=(value??label); return o; }
  function uniq(a){ return [...new Set(a.filter(Boolean))]; }
  function is2D(x){ return Array.isArray(x)&&x.every(r=>Array.isArray(r)); }
  function normalize(data){
    if (is2D(data)) return data;
    if (data && is2D(data.data)) return data.data;
    if (data && is2D(data.grid)) return data.grid;
    if (data && is2D(data.values)) return data.values;
    throw new Error("資料格式錯誤");
  }

  function buildMaps(){
    rows = grid.slice(10, 106);
    typeToItems.clear(); itemToAccs.clear();
    for(const r of rows){
      const type = (r?.[0]||'').trim();
      const item = (r?.[1]||'').trim();
      if(!type||!item) continue;
      if(!typeToItems.has(type)) typeToItems.set(type, []);
      typeToItems.get(type).push(item);
      const accs = uniq((r.slice(5,15)||[]).map(x=> (x||'').toString().trim()).filter(Boolean));
      if(accs.length) itemToAccs.set(item, accs);
    }
    for(const [k,v] of typeToItems.entries()) typeToItems.set(k, uniq(v));
  }
  function fillType(){ typeSel.innerHTML=''; typeSel.append(opt('請選擇','')); [...typeToItems.keys()].forEach(t=> typeSel.append(opt(t,t))); }
  function fillAB(type){
    const items = typeToItems.get(type)||[];
    aSel.innerHTML=''; bSel.innerHTML=''; aSel.append(opt('商品','')); bSel.append(opt('商品',''));
    items.forEach(i=>{ aSel.append(opt(i,i)); bSel.append(opt(i,i)); });
    if(type==='雞蛋糕'){ bWrap.style.display=''; } else { bWrap.style.display='none'; bSel.value=''; }
    updateAccessoryOptions();
  }
  function updateAccessoryOptions(){
    const finalName = bSel.value || aSel.value || '';
    const options = uniq(itemToAccs.get(finalName)||[]);
    accSelects.forEach(sel=>{
      const keep = sel.value; sel.innerHTML=''; sel.append(opt('附','')); options.forEach(x=> sel.append(opt(x,x)));
      if(keep && options.includes(keep)) sel.value = keep;
    });
  }
  typeSel.addEventListener('change', e=> fillAB(e.target.value));
  aSel.addEventListener('change', updateAccessoryOptions);
  bSel.addEventListener('change', updateAccessoryOptions);

  // Price helpers (simplified): find unit price at PAY column of price sheet header in row index 6 (P..AD)
  function cashPriceForRow(row){
    const headers = (grid[6]||[]).slice(15,30);
    const idx = headers.indexOf(PAY);
    const arr = row.slice(15,30);
    const v = parseFloat(arr[idx]||0);
    return isFinite(v)? v:0;
  }
  function portionSizeForRow(row){ // AE (index 30)
    const v = parseFloat(row[30]||0);
    return (isFinite(v)&&v>0)? v:1;
  }
  function canJoinFullSet(row){ // AF (index 31) = 是/否
    return ((row[31]||'')+'').trim()==='是';
  }

  // Order → expand portions (store-like; A/B → build one portion price)
  function expandPortions(){
    const portions=[]; // each = {price, canSet}
    for (const it of cart){
      const {type,a,b,qty} = it;
      const aRow = rows.find(r=> r[1]===a);
      const bRow = rows.find(r=> r[1]===b);
      if(type==='雞蛋糕'){
        // 一份的份價：若 A+B；單選就 A×2
        const aPrice = aRow? cashPriceForRow(aRow):0;
        const bPrice = bRow? cashPriceForRow(bRow):0;
        const psize = (aRow?portionSizeForRow(aRow):1); // 以 A 的 AE 當份量（店內若不同可再調）
        const canSet = (aRow?canJoinFullSet(aRow):true);
        let portionPrice=0;
        if (a && b) portionPrice = aPrice + bPrice;
        else if (a && !b) portionPrice = aPrice*2;
        else if (!a && b) portionPrice = bPrice*2;
        for(let i=0;i<qty;i++){ portions.push({price:portionPrice, canSet}); }
      }else{
        const row = aRow || bRow;
        if (!row) continue;
        const unit = cashPriceForRow(row);
        const per = portionSizeForRow(row);
        const canSet = canJoinFullSet(row);
        const portionPrice = unit*per;
        for(let i=0;i<qty;i++){ portions.push({price:portionPrice, canSet}); }
      }
    }
    return portions;
  }

  function calcTotals(){
    const portions = expandPortions();
    // 訂單金額 = 所有份價相加
    let orderAmt = portions.reduce((s,p)=> s + p.price, 0);

    // 可參與滿份折扣的份：
    const eligible = portions.filter(p=> p.canSet).map(p=> p.price).sort((a,b)=> a-b);
    const cycles = Math.floor(eligible.length / CYCLE_SET);
    const discountParts = eligible.slice(0, cycles); // 折最便宜的每循環一份
    const discountAmt = discountParts.reduce((s,p)=> s + p, 0);

    const payAmt = orderAmt - discountAmt;

    // 點數：循環 1 點 + 剩餘份金額按 60 元 1 點（最高 9）
    const leftoverCount = eligible.length - cycles*CYCLE_SET;
    const leftoverAmt = eligible.slice(cycles).reduce((s,p)=> s + p, 0);
    const cyclePoints = cycles * 1;
    const leftoverPoints = Math.min(MAX_LEFTOVER_POINTS, Math.floor(leftoverAmt / MONEY_PER_POINT));
    const totalPoints = cyclePoints + leftoverPoints;

    return {orderAmt, cycles, discountAmt, payAmt, totalPoints};
  }

  function renderSummary(){
    const {orderAmt, cycles, discountAmt, payAmt, totalPoints} = calcTotals();
    summaryLine.textContent = `訂單金額 ${orderAmt.toFixed(0)} 元；滿份折 ${cycles} 份 ${discountAmt.toFixed(0)} 元；結帳金額 ${payAmt.toFixed(0)} 元；點數發放 ${totalPoints} 點`;
  }

  function renderCart(){
    cartCount.textContent = String(cart.length);
    cartList.innerHTML = '';
    if(!cart.length){ cartEmpty.style.display=''; renderSummary(); return; }
    cartEmpty.style.display='none';
    cart.forEach((it, idx)=>{
      const row = document.createElement('div'); row.className='mh-cart-item';
      const title = document.createElement('div'); title.className='mh-name'; title.textContent = `${it.title} × ${it.qty}`;
      const edit = document.createElement('button'); edit.className='mh-edit'; edit.textContent='編輯';
      edit.addEventListener('click', ()=>{
        openPanel();
        typeSel.value = it.type; fillAB(it.type);
        aSel.value = it.a || ''; bSel.value = it.b || ''; updateAccessoryOptions();
        qtyInput.value = it.qty;
        accSelects.forEach((s,i)=> s.value = it.accs?.[i] || '');
        // 更新改為覆蓋此索引
        addBtn.textContent = '更新項目';
        addInline.textContent = '更新項目';
        const handler = ()=>{
          const type = typeSel.value.trim();
          const qty = Math.max(1, parseInt(qtyInput.value||'1',10));
          const a = aSel.value.trim(); const b=bSel.value.trim();
          const accs = accSelects.map(s => s.value.trim()).filter(Boolean);
          const title = summarizeName(type,a,b,accs);
          cart[idx] = { type, qty, a, b, accs, title };
          addBtn.textContent='加入購物車'; addInline.textContent='加入購物車';
          addBtn.removeEventListener('click', handler); addInline.removeEventListener('click', handler);
          renderCart();
        };
        addBtn.addEventListener('click', handler);
        addInline.addEventListener('click', handler);
      });
      const del = document.createElement('button'); del.className='mh-del'; del.textContent='刪除';
      del.addEventListener('click', ()=>{ cart.splice(idx,1); renderCart(); });
      row.append(title, edit, del); cartList.appendChild(row);
    });
    renderSummary();
  }

  function summarizeName(type,a,b,accs){
    let base='';
    if(type==='雞蛋糕'){
      if(a && b) base = [a,b].sort().join('+');
      else if(a && !b) base = a + '+' + a;
      else if(!a && b) base = b + '+' + b;
      else base = '';
    }else{
      base = a || b || '';
    }
    const ext = accs.length ? '('+accs.join('+')+')' : '';
    return base + ext;
  }

  function resetForm(){
    typeSel.value=''; fillAB(''); qtyInput.value=1; aSel.value=''; bSel.value=''; accSelects.forEach(s=> s.value='');
  }

  function addCurrent(){
    const type = typeSel.value.trim();
    const qty = Math.max(1, parseInt(qtyInput.value||'1',10));
    const a = aSel.value.trim(); const b=bSel.value.trim();
    if(!type || (!a && !b)){ alert('請至少選擇「品項」與「商品」其一。'); return; }
    const accs = accSelects.map(s => s.value.trim()).filter(Boolean);
    const title = summarizeName(type,a,b,accs);
    cart.push({ type, qty, a, b, accs, title });
    renderCart();
    if (window.matchMedia('(max-width:1023.98px)').matches){ cartEl.classList.add('open'); }
    resetForm();
  }

  addBtn.addEventListener('click', addCurrent);
  addInline.addEventListener('click', addCurrent);
  resetBtn.addEventListener('click', resetForm);
  resetInline.addEventListener('click', resetForm);
  clearBtn.addEventListener('click', ()=>{ cart=[]; renderCart(); });

  // Compose message
  function formatDate(dt){
    try{
      const d=new Date(dt); const y=d.getFullYear(); const m=String(d.getMonth()+1).padStart(2,'0');
      const day=String(d.getDate()).padStart(2,'0'); const hh=String(d.getHours()).padStart(2,'0'); const mm=String(d.getMinutes()).padStart(2,'0');
      return `${y}/${m}/${day} ${hh}:${mm}`;
    }catch(e){ return ''; }
  }
  function orderItemsText(){ return cart.map(it => `${it.title} × ${it.qty}`).join('；'); }
  function buildMessage(){
    const itemsText = orderItemsText() || '（尚未選擇商品）';
    const whenText = whenInput.value ? ` ${formatDate(whenInput.value)}` : '';
    const addr = addrInput.value.trim(), sign=signInput.value.trim(), name=nameInput.value.trim(), phone=phoneInput.value.trim();
    if (addr && sign){
      return `老闆你好，我要 ${itemsText} ，請幫我外送到(${addr})(${sign})(${name})(${phone})` + (whenText? ` 請在${whenText} 送達`:'') + `，謝謝。`;
    } else {
      const who = [name, phone].filter(Boolean).join(' / ');
      return `老闆你好，我要 ${itemsText}` + (who? ` ，${who}`:'') + (whenText? ` ，預計${whenText} 取餐`:'') + `，謝謝。`;
    }
  }
  async function copyMessage(){
    const msg = buildMessage();
    try{ await navigator.clipboard.writeText(msg); alert('訂單內容已複製到剪貼簿，可直接貼上對話視窗。'); }
    catch(e){ const ta=document.createElement('textarea'); ta.value=msg; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove(); alert('已嘗試複製到剪貼簿。'); }
  }
  copyBtn.addEventListener('click', copyMessage);
  sendBtn.addEventListener('click', async ()=>{ await copyMessage(); const [t,url]=channelSel.value.split('|'); window.open(url,'_blank'); });

  // Init
  (async function init(){
    try{
      const res = await fetch(DATA_URL, {cache:'no-store'});
      const raw = await res.json(); grid = normalize(raw); buildMaps(); fillType(); placeAll();
    }catch(err){ console.error(err); alert('載入菜單資料失敗：' + (err.message||'')); }
  })();
})();
</script>


<script>
// v1.7.1: toggle cart open/close + ensure placement on open (desktop)
(function(){
  const cartEl = document.getElementById('mh-cart');
  const fab = document.getElementById('mh-fab');
  const cartFab = document.getElementById('mh-cart-fab');
  const placeAll = window.placeAll || function(){};

  function toggleCart(forceOpen){
    if (!cartEl) return;
    if (typeof forceOpen === 'boolean'){
      cartEl.classList.toggle('open', forceOpen);
    }else{
      cartEl.classList.toggle('open');
    }
    if (window.matchMedia('(min-width:1024px)').matches && cartEl.classList.contains('open')){
      placeAll();
    }
  }

  if (cartFab){
    cartFab.addEventListener('click', ()=> toggleCart());
  }
  // Optional: 點餐時同時秀出購物車（可自行關閉）
  if (fab){
    fab.addEventListener('click', ()=> {
      if (window.matchMedia('(min-width:1024px)').matches){
        // 桌面：點餐時不自動開購物車，保留你原本習慣
      }else{
        // 手機：點餐不動購物車，由使用者按購物車 FAB 控制
      }
    });
  }

  // 當加入商品時，手機自動開購物車；桌面仍維持原樣（透過按鈕控制）
  const _addCurrent = window.addCurrent;
  if (typeof _addCurrent === 'function'){
    window.addCurrent = function(){
      _addCurrent();
      if (window.matchMedia('(max-width:1023.98px)').matches){
        toggleCart(true);
      }
    }
  }
})();
</script>


<script>
// === v1.7.2: cart close button + desktop cart FAB positioning ===
(function(){
  const cartEl = document.getElementById('mh-cart');
  const cartFab = document.getElementById('mh-cart-fab');
  const closeBtn = document.getElementById('mh-cart-close');
  const menuRoot = document.querySelector('#menu-root, main .markdown-body, main, article, .content, .post, .wrap, .container');

  function placeAtMenuEdge(el, extraTop){
    const rect = menuRoot?.getBoundingClientRect?.();
    if (rect && window.matchMedia('(min-width:1024px)').matches){
      el.style.left = (rect.right + 12) + 'px';
      if (typeof extraTop === 'number') el.style.top = extraTop + 'px';
    }
  }

  function placeDesktopFab(){
    if (!cartFab) return;
    if (window.matchMedia('(min-width:1024px)').matches){
      placeAtMenuEdge(cartFab, 14);
    }
  }

  function toggleCart(force){
    if (!cartEl) return;
    if (typeof force === 'boolean'){
      cartEl.classList.toggle('open', force);
    }else{
      cartEl.classList.toggle('open');
    }
  }

  cartFab && cartFab.addEventListener('click', ()=> toggleCart());
  closeBtn && closeBtn.addEventListener('click', ()=> toggleCart(false));

  window.addEventListener('resize', placeDesktopFab);
  window.addEventListener('scroll', placeDesktopFab);
  placeDesktopFab();
})();
</script>


<script>
// === v1.7.3: desktop button stacking & ensure 點餐 button visible ===
(function(){
  const menuRoot = document.querySelector('#menu-root, main .markdown-body, main, article, .content, .post, .wrap, .container');
  const orderFab = document.getElementById('mh-fab');       // 🧾 點餐
  const cartFab  = document.getElementById('mh-cart-fab');  // 🛒 購物車

  function placeAtMenuEdge(el, topOffset){
    if (!el) return;
    const rect = menuRoot?.getBoundingClientRect?.();
    if (rect && window.matchMedia('(min-width:1024px)').matches){
      el.style.left = (rect.right + 12) + 'px';
      el.style.top = (topOffset || 14) + 'px';
      el.style.right = 'auto';
      el.style.bottom = 'auto';
      el.style.transform = 'none';
      el.style.position = 'fixed';
      el.style.display = 'inline-block';
    }
  }
  function placeDesktopButtons(){
    if (!window.matchMedia('(min-width:1024px)').matches) return;
    placeAtMenuEdge(orderFab, 14);   // 點餐（上）
    placeAtMenuEdge(cartFab, 58);    // 購物車（下）
  }
  window.addEventListener('resize', placeDesktopButtons);
  window.addEventListener('scroll', placeDesktopButtons);
  placeDesktopButtons();
})();
</script>

</body></html>
