<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>Excel Grid</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; }
    th, td {
      border: 1px solid #ccc; min-width: 60px; height: 24px; text-align: center;
    }
    th { background: #eee; position: sticky; top: 0; z-index: 2; }
    th:first-child, td:first-child {
      position: sticky; left: 0; background: #f3f3f3; z-index: 1;
    }
    td:focus { outline: 2px solid #0078D7; }
    #saveBtn { margin: 10px 0; padding: 8px 16px; }
  </style>
</head>
<body>

<h2>Excel Grid 50 Ã— 106</h2>
<button id="saveBtn">ğŸ’¾ å„²å­˜</button>
<table id="grid">
  <thead><tr><th></th></tr></thead>
  <tbody></tbody>
</table>

<script>
const ROWS = 106, COLS = 50;
const user = 'menghushao', repo = 'Order-management';
const thead = document.querySelector('#grid thead tr');
const tbody = document.querySelector('#grid tbody');

for (let c = 0; c < COLS; c++) {
  let label = '', n = c;
  while (n >= 0) {
    label = String.fromCharCode(n % 26 + 65) + label;
    n = Math.floor(n / 26) - 1;
  }
  const th = document.createElement('th');
  th.textContent = label;
  thead.appendChild(th);
}

for (let r = 0; r < ROWS; r++) {
  const tr = document.createElement('tr');
  const rowTh = document.createElement('th');
  rowTh.textContent = r + 1;
  tr.appendChild(rowTh);
  for (let c = 0; c < COLS; c++) {
    const td = document.createElement('td');
    td.contentEditable = true;
    tr.appendChild(td);
  }
  tbody.appendChild(tr);
}

function getHTML() {
  return document.documentElement.outerHTML;
}

document.getElementById('saveBtn').onclick = async () => {
  const html = getHTML();
  const b64 = btoa(unescape(encodeURIComponent(html)));
  const token = prompt("è«‹è¼¸å…¥ä½ çš„ GitHub Tokenï¼ˆåƒ…åœ¨æœ¬åœ°åŸ·è¡Œï¼‰");
  if (!token) return;

  const res = await fetch(`https://api.github.com/repos/${user}/${repo}/issues`, {
    method: 'POST',
    headers: {
      Authorization: `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      title: `ğŸ“ html update: ${new Date().toISOString()}`,
      body: b64
    })
  });

  if (res.ok) {
    alert('âœ… å·²é€å‡ºå„²å­˜è«‹æ±‚ï¼ˆå¹¾ç§’å¾Œè‡ªå‹•æ›´æ–° index.htmlï¼‰');
  } else {
    alert('âŒ ç™¼é€å¤±æ•—ï¼š' + res.status);
  }
};
</script>
</body>
</html>
