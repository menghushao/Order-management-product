<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>Excel-like Grid</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; }
    th, td {
      border: 1px solid #ccc;
      min-width: 60px; height: 24px; text-align: center;
    }
    th { background: #eee; position: sticky; top: 0; z-index: 2; }
    th:first-child, td:first-child {
      position: sticky; left: 0; background: #f3f3f3; z-index: 1;
    }
    td:focus { outline: 2px solid #0078D7; }
    button { margin: 10px 0; padding: 8px 16px; }
  </style>
</head>
<body>

<h3>Excel Gridï¼ˆ106 Ã— 50ï¼‰</h3>
<button onclick="save()">ğŸ’¾ å„²å­˜ï¼ˆè¦†è“‹ index.htmlï¼‰</button>
<table id="grid">
  <thead><tr><th></th></tr></thead>
  <tbody></tbody>
</table>

<script>
const ROWS = 106, COLS = 50;
const user = 'menghushao';
const repo = 'Order-management';
const path = 'index.html';
const branch = 'main';

const thead = document.querySelector('#grid thead tr');
const tbody = document.querySelector('#grid tbody');

// ç”¢ç”Ÿæ¬„ä½æ¨™ç±¤
for (let c = 0; c < COLS; c++) {
  let label = '', n = c;
  while (n >= 0) {
    label = String.fromCharCode(n % 26 + 65) + label;
    n = Math.floor(n / 26) - 1;
  }
  const th = document.createElement('th');
  th.textContent = label;
  thead.appendChild(th);
}

// ç”¢ç”Ÿå…§å®¹åˆ—
for (let r = 0; r < ROWS; r++) {
  const tr = document.createElement('tr');
  const rowTh = document.createElement('th');
  rowTh.textContent = r + 1;
  tr.appendChild(rowTh);
  for (let c = 0; c < COLS; c++) {
    const td = document.createElement('td');
    td.contentEditable = true;
    tr.appendChild(td);
  }
  tbody.appendChild(tr);
}

// å„²å­˜æŒ‰éˆ•äº‹ä»¶
async function save() {
  const token = prompt("è«‹è¼¸å…¥ GitHub Tokenï¼ˆä¸æœƒå„²å­˜ï¼‰");
  if (!token) return;

  const html = document.documentElement.outerHTML;
  const content = btoa(unescape(encodeURIComponent(html)));

  const getURL = `https://api.github.com/repos/${user}/${repo}/contents/${path}?ref=${branch}`;
  const res = await fetch(getURL, {
    headers: { Authorization: `Bearer ${token}` }
  });
  const info = await res.json();
  const sha = info.sha;

  const putURL = `https://api.github.com/repos/${user}/${repo}/contents/${path}`;
  const update = await fetch(putURL, {
    method: 'PUT',
    headers: {
      Authorization: `Bearer ${token}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      message: 'æ›´æ–° index.html',
      content: content,
      sha,
      branch
    })
  });

  if (update.ok) {
    alert('âœ… å„²å­˜å®Œæˆï¼Œå·²æ›´æ–° index.html');
  } else {
    alert('âŒ å„²å­˜å¤±æ•—');
  }
}
</script>
</body>
</html>
